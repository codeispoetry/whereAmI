<!DOCTYPE html>
<html>
<head>
    <style>
        #map {
            position: relative;
            width: 100%;
        }
        #dot {
            position: absolute;
        }
        #message {
            font-size: 3em;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="message"></div>
    <div id="map">
        <img src="map.jpg" alt="Map" style="width:100%;">
        <div id="dot">
            <svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="50" fill="red">
                    <animate attributeName="r" from="0" to="50" dur="2s" begin="0s" repeatCount="indefinite" />
                    <animate attributeName="opacity" from="1" to="0.1" dur="2s" begin="0s" repeatCount="indefinite" />
                </circle>
            </svg>
        </div>
    </div>

    <script>
        const corner = {
            top: 48.495996,
            bottom: 48.488030,
            left: 9.293618,
            right: 9.304026
        }

        const dot = document.getElementById('dot');
        const message = document.getElementById('message');

        window.onload = function() {
            getPosition();
            setInterval(getPosition, 1000);
        }

        function getPosition(){
            navigator.geolocation.getCurrentPosition(position => { 
              
                if (position.coords.latitude < corner.bottom || position.coords.latitude > corner.top || position.coords.longitude < corner.left || position.coords.longitude > corner.right) {
                    message.innerText = 'Du befindest Dich auÃŸerhalb der Rallye-Zone!';
                    dot.style.display = 'none';
                    return;
                }

                if( position.coords.accuracy > 150 ) {
                    message.innerText = 'GPS-Signal zu schwach!';
                    dot.style.display = 'none';
                    return;
                }

                dot.style.display = 'block';
                message.innerText = '';
                console.log(position.coords.latitude, position.coords.longitude);
                setDot(position.coords.latitude, position.coords.longitude);
            });
        }

        function setDot(lat, lon) {
            lat = (lat - corner.bottom) / (corner.top - corner.bottom) * 100;
            lon = (lon - corner.left) / (corner.right - corner.left) * 100;
            dot.style.left = lon + '%';
            dot.style.top = lat + '%';
        }

        function setMessage(text) {
            message.innerText = text;
        }
    </script>
</body>
</html>